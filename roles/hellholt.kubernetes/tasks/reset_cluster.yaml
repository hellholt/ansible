---
- name: 'Reset and reinitialize the cluster.'
  remote_user: 'root'
  block:

    - name: 'Run setup for this host.'
      ansible.builtin.setup:

    - name: 'Reset the cluster nodes.'
      ansible.builtin.command:
        cmd: 'kubeadm reset --force'

    - name: 'Rebuild the cluster.'
      ansible.builtin.include_role:
        name: 'hellholt.setup_host'
        tasks_from: 'setup_groups/k8s.yaml'

    - name: 'Retrieve the config.'
      ansible.builtin.include_tasks: 'cluster_groups/get_config.yaml'
