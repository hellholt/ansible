---
- name: 'Create sudo group.'
  ansible.builtin.group:
    name: 'sudo'
    state: 'present'

- name: 'Create a password for the user account.'
  ansible.builtin.set_fact:
    sh_password: "{{ lookup('password', '/dev/null length=12 chars=ascii_letters,digits,punctuation') }}"

- name: 'Create normal user account.'
  ansible.builtin.user:
    name: "{{ sh_normal_user_name }}"
    password: "{{ sh_password | password_hash('sha512', sh_hostname) }}"
    shell: '/bin/bash'
    append: yes
    groups: 'sudo'
    create_home: yes

- name: 'Set SSH key for user account.'
  ansible.posix.authorized_key:
    user: "{{ sh_normal_user_name }}"
    state: 'present'
    key: "{{ admin_ssh_public_key }}"
